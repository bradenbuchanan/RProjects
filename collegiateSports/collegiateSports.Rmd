---
title: "collegiateSports"
author: "Braden Buchanan"
date: "2023-09-08"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# load packages
```{r}
library(tidyverse)
library(stringr)
library(forcats)
library(scales)
```

# Load data
```{r}
sports <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-03-29/sports.csv')
```

### Check out data
```{r}
colnames(sports)
str(sports)
summary(sports)
```

# Descriptive Statistics

### What schools generate the most revenue?
```{r}
highestRevSchools2019 <- sports %>%
  select(year, institution_name, state_cd, total_rev_menwomen, sports) %>%
  filter(year == 2019) %>%
  arrange(desc(total_rev_menwomen)) %>%
  head(n = 10)

ggplot(highestRevSchools2019, aes(x = total_rev_menwomen, y = fct_reorder(institution_name, total_rev_menwomen))) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::dollar(total_rev_menwomen)), vjust = .3, hjust = 1.1, color = "white", size = 3.5) +
  scale_x_continuous(labels = scales::dollar_format(scale = 1)) +
  labs(title = "Top 10 Schools by Revenue in 2019",
       x = "Total Revenue",
       y = "Institution Name")
```

### What schools generate the least revenue?
```{r}
lowestRevSchools2019 <- sports %>%
  select(year, institution_name, state_cd, total_rev_menwomen, sports) %>%
  filter(year == 2019) %>%
  arrange(total_rev_menwomen) %>%
  distinct(institution_name, .keep_all = TRUE) %>%
  head(n=10)

ggplot(lowestRevSchools2019, aes(x = total_rev_menwomen, y = fct_reorder(institution_name, total_rev_menwomen))) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = scales::dollar(total_rev_menwomen)), vjust = .3, hjust = 1.1, color = "white", size = 3.5) +
  scale_x_continuous(labels = scales::dollar_format(scale = 1)) +
  labs(title = "Top 10 Schools that earned the least revenue in 2019",
       x = "Total Revenue",
       y = "Institution Name")
```

### What sports programs generate the most revenue for their schools?
```{r}
sports %>%
  group_by(sports) %>%
  summarise(total_revenue = sum(total_rev_menwomen, na.rm = TRUE)) %>%
  arrange(desc(total_revenue)) %>%
  head(10)

top_schools <- sports %>%
  group_by(institution_name) %>%
  summarise(school_total_revenue = sum(total_rev_menwomen, na.rm = TRUE)) %>%
  arrange(desc(school_total_revenue)) %>%
  head(10) %>%
  pull(institution_name)

# List the revenues of sports programs for each of these top 10 schools
sports_breakdown <- sports %>%
  filter(institution_name %in% top_schools, 
         !(sports %in% c("Rifle", "Weight lifting", "Archery", "Synchronized Swimming", "Diving", "Badminton", "Table Tennis", "Team Handball", "Rodeo", "Skiiing", "Track and Field, Indoor", "Track and Field, X-Country", "Track and Field, Outdoor"))) %>%
  group_by(institution_name, sports) %>%
  summarise(sport_revenue = sum(total_rev_menwomen, na.rm = TRUE)) %>%
  arrange(institution_name, desc(sport_revenue))

print(sports_breakdown)

# Let's assume your tibble is stored in a variable named `sports_revenue`
sports_breakdown %>%
  ggplot(aes(x = sports, y = sport_revenue, fill = institution_name)) +
  geom_bar(stat = "identity", position = "dodge") +  
  scale_y_continuous(labels = scales::dollar_format(scale = 1)) +  # Format the revenue in dollar format
  coord_flip() +
  labs(title = "Sports Revenue by Institution",
       x = "Sport",
       y = "Revenue") +
  theme_minimal() +
  theme(legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))
```

### Revenue by sports for UT Austin
```{r}
sports %>%
  select(year, institution_name, partic_men, partic_women, total_rev_menwomen, sports) %>%
  filter(!is.na(total_rev_menwomen) & institution_name == "The University of Texas at Austin" & year == 2019) %>%
  arrange(desc(total_rev_menwomen))
```

### Revenue by sports for Indiana University
```{r}
indianaUniversity <- sports %>%
  select(year, institution_name, sports, total_rev_menwomen) %>%
  filter(year == 2019, institution_name == "Indiana University-Bloomington") %>%
  arrange(desc(total_rev_menwomen)) %>%
  head(15) %>%
  ggplot(aes(total_rev_menwomen, sports, fill = sports)) +
  geom_bar(stat = "identity") +
  scale_x_continuous(labels = scales::dollar_format(scale = 1)) +
  labs(title = "Revenue by sports for Indiana University",
       x = "Sport",
       y = "Revenue") +
  theme_minimal() +
  theme(legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))

print(indianaUniversity)
```

### What Sport do women participate in the most in college?
```{r}
sports %>%
  select(sports, partic_women) %>%
  group_by(sports) %>%
  summarise(total_women = sum(partic_women, na.rm = TRUE)) %>%
  arrange(desc(total_women))
```

### What is the distribuion between men and womens in different sports in college?
```{r}
menWomenParicSports <- sports %>%
  select(sports, partic_men, partic_women) %>%
  group_by(sports) %>%
  summarise(
    total_women = sum(partic_women, na.rm = TRUE), 
    total_men = sum(partic_men, na.rm = TRUE)
  )

library(scales)

menWomenParicSports %>%
  ggplot(aes(x = sports)) +
  geom_bar(aes(y = total_men, fill = "Men"), stat = "identity") +
  geom_bar(aes(y = total_women, fill = "Women"), stat = "identity", position = "stack") +
  coord_flip() +
  labs(title = "Distribution of Men and Women in College Sports",
       x = "Sport", y = "Number of Participants") +
  theme_minimal() +
  scale_fill_manual(values = c("Men" = "blue", "Women" = "pink")) +
  scale_y_continuous(labels = comma)
```

